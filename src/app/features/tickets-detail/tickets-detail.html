<div class="section">
  <app-sidebar [isOpen]="sidebarOpen"></app-sidebar>
</div>
<div class="main-content" [class.expanded]="!sidebarOpen">
  <app-navbar
    [isSidebarOpen]="sidebarOpen"
    (sidebarToggle)="toggleSidebar()"
  ></app-navbar>

  <div class="flex flex-col px-4" *ngIf="ticket as t; else cargando">
    <div
      class="flex flex-col sm:flex-row sm:items-center justify-between gap-4"
    >
      <div class="flex items-center gap-2 py-2">
        <p-button
          label="Volver"
          icon="pi pi-arrow-left"
          [text]="true"
          [routerLink]="['/Tickets']"
          class="text-[#1C3D67]"
        ></p-button>
      </div>
      <div class="flex gap-2">
        <p-tag
          [value]="formatEstado(t.ticket_ind_estado)"
          [severity]="getEstadoSeverity(t.ticket_ind_estado)"
        ></p-tag>
        <p-tag
          [value]="'PRIORIDAD ' + t.ticket_prioridad"
          [severity]="getPrioridadSeverity(t.ticket_prioridad)"
        ></p-tag>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="lg:col-span-2 space-y-6">
        <div class="flex-1">
          <h1 class="text-3xl font-bold tracking-tight">
            {{ t.ticket_codigo }}
          </h1>
          <p class="text-gray-500">{{ t.ticket_nombre }}</p>
        </div>

        <p-card>
          <ng-template pTemplate="header">
            <span class="font-semibold flex items-center gap-2"
              ><i class="pi pi-file"></i> Nombre</span
            >
          </ng-template>
          <p>{{ t.ticket_nombre }}</p>
        </p-card>

        <p-card>
          <ng-template pTemplate="header">
            <span class="font-semibold flex items-center gap-2"
              ><i class="pi pi-comment"></i> Observaciones</span
            >
          </ng-template>
          <div class="text-sm text-gray-700 mb-4">
            {{ t.ticket_plan_inte_id }}
          </div>
          <p-divider></p-divider>
          <div class="space-y-2">
            <label for="comentario" class="text-sm font-medium"
              >Agregar comentario</label
            >
            <textarea
              pInputTextarea
              id="comentario"
              [(ngModel)]="comentario"
              rows="4"
              class="w-full"
              placeholder="Escribe tu comentario aquí..."
            ></textarea>
            <button
              pButton
              label="Agregar Comentario"
              class="p-button-sm mt-2"
            ></button>
          </div>
        </p-card>

        <p-card>
          <ng-template pTemplate="header">
            <span class="font-semibold flex items-center gap-2"
              ><i class="pi pi-clock"></i> Historial de Actividad</span
            >
          </ng-template>
          <div class="space-y-4"></div>
        </p-card>
      </div>

      <div class="space-y-6">
        <p-card>
          <ng-template pTemplate="header">
            <span class="font-semibold">Información del Ticket</span>
          </ng-template>
          <div class="space-y-4 text-sm">
            <div class="flex gap-2 items-start">
              <i class="pi pi-calendar text-gray-500 mt-1"></i>
              <div>
                <p class="font-medium">Fecha de Creación</p>
                <p class="text-gray-500">
                  {{ formatDate(t.ticket_fecha_registro) }}
                </p>
              </div>
            </div>
            <div class="flex gap-2 items-start">
              <i class="pi pi-user text-gray-500 mt-1"></i>
              <div>
                <p class="font-medium">Solicitante</p>
                <p class="text-gray-500">{{ t.ticket_usua_id }}</p>
              </div>
            </div>
            <div class="flex gap-2 items-start">
              <i class="pi pi-building text-gray-500 mt-1"></i>
              <div>
                <p class="font-medium">Departamento</p>
                <p class="text-gray-500">{{ t.ticket_schema }}</p>
              </div>
            </div>
          </div>
        </p-card>

        <p-card>
          <ng-template pTemplate="header">
            <span class="font-semibold">Acciones</span>
          </ng-template>
          <div class="space-y-2">
            <button
              pButton
              label="Cambiar Estado"
              class="w-full bg-black text-white hover:bg-gray-900"
            ></button>
            <button
              pButton
              label="Asignar Técnico"
              class="w-full p-button-outlined"
            ></button>
            <button
              pButton
              label="Cambiar Prioridad"
              class="w-full p-button-outlined"
            ></button>
            <button
              pButton
              label="Cerrar Ticket"
              class="w-full p-button-danger"
            ></button>
          </div>
        </p-card>
      </div>
    </div>
  </div>

  <ng-template #cargando>
    <div class="p-4 text-gray-500">Cargando ticket…</div>
  </ng-template>
</div>
